const JS_DIR_IMAGES = 'templates/tibiacom/images/'

function runWodPlanner(t, e) {
    let d = ""
      , c = ""
      , H = ""
      , O = 0
      , o = null
      , g = null
      , h = null
      , v = []
      , y = null
      , Q = ""
      , R = ""
      , T = ""
      , n = ""
      , r = ""
      , a = ""
      , oe = ""
      , l = ""
      , ue = ""
      , f = ""
      , w = ""
      , I = ""
      , b = ""
      , G = ""
      , N = ""
      , se = ""
      , de = ""
      , M = ""
      , _ = ""
      , L = ""
      , x = ""
      , B = ""
      , ce = ""
      , S = ""
      , q = ""
      , E = ""
      , F = ""
      , fe = ""
      , ge = ""
      , he = ""
      , ve = ""
      , me = ""
      , pe = ""
      , Ae = ""
      , ke = null
      , we = null
      , $e = null
      , Ie = null
      , be = null
      , Ge = null
      , Me = null
      , Qe = null
      , Re = null
      , Te = null
      , _e = null
      , Le = null
      , xe = null
      , Be = null
      , Se = null
      , qe = null
      , ye = null
      , Pe = null
      , De = null
      , We = null
      , Ce = null
      , Ue = !1
      , Ee = !1
      , J = null;
    const u = new Map
      , V = new Map;
    let Fe = []
      , He = []
      , Oe = []
      , Ne = []
      , Je = []
      , Ve = []
      , ze = []
      , Ze = 0
      , Ke = 0
      , je = 0;
    const P = {
        Knight: "knight",
        Druid: "druid",
        Sorcerer: "sorcerer",
        Paladin: "paladin",
        t: "TopLeft",
        l: "TopRight",
        i: "BottomLeft",
        o: "BottomRight",
        QTL0: "QTL0",
        QTL1: "QTL1",
        QTL2: "QTL2",
        QTL3: "QTL3",
        QTL4: "QTL4",
        QTL5: "QTL5",
        QTL6: "QTL6",
        QTL7: "QTL7",
        QTL8: "QTL8",
        QTR0: "QTR0",
        QTR1: "QTR1",
        QTR2: "QTR2",
        QTR3: "QTR3",
        QTR4: "QTR4",
        QTR5: "QTR5",
        QTR6: "QTR6",
        QTR7: "QTR7",
        QTR8: "QTR8",
        QBL0: "QBL0",
        QBL1: "QBL1",
        QBL2: "QBL2",
        QBL3: "QBL3",
        QBL4: "QBL4",
        QBL5: "QBL5",
        QBL6: "QBL6",
        QBL7: "QBL7",
        QBL8: "QBL8",
        QBR0: "QBR0",
        QBR1: "QBR1",
        QBR2: "QBR2",
        QBR3: "QBR3",
        QBR4: "QBR4",
        QBR5: "QBR5",
        QBR6: "QBR6",
        QBR7: "QBR7",
        QBR8: "QBR8",
        u: "Unique",
        g: "SkillBonus",
        h: "Leech",
        v: "Augmentation",
        m: "VesselResonance",
        p: "Other",
        A: "ModEffect",
        k: "ModAugCd",
        $: "ModAugCrit",
        I: "ModAugDmg",
        G: "ModAugHeal",
        M: "ModAugOther",
        R: "ModRevelation"
    }
      , m = {
        T: "#46b21c31",
        _: "#94c4126b",
        L: "#ae143431",
        B: "#ef1a386b",
        S: "#198d4031",
        q: "#18cd8f6b",
        P: "#841d9e31",
        D: "#e618da6b",
        W: "#80808067",
        C: 2,
        U: Math.PI / 180,
        F: 180 / Math.PI
    };
    let z = P.Knight
      , Z = []
      , K = []
      , j = null
      , X = null
      , Y = null
      , ee = null
      , ne = null
      , te = null;
    const p = 261
      , Xe = 50
      , A = [{
        id: P.QTL0,
        radiusIndex: 0,
        startAngleGrad: 180,
        endAngleGrad: 270,
        quarter: P.t
    }, {
        id: P.QTL1,
        radiusIndex: 1,
        startAngleGrad: 180,
        endAngleGrad: 225,
        quarter: P.t
    }, {
        id: P.QTL3,
        radiusIndex: 1,
        startAngleGrad: 225,
        endAngleGrad: 270,
        quarter: P.t
    }, {
        id: P.QTL2,
        radiusIndex: 2,
        startAngleGrad: 180,
        endAngleGrad: 210,
        quarter: P.t
    }, {
        id: P.QTL4,
        radiusIndex: 2,
        startAngleGrad: 210,
        endAngleGrad: 240,
        quarter: P.t
    }, {
        id: P.QTL6,
        radiusIndex: 2,
        startAngleGrad: 240,
        endAngleGrad: 270,
        quarter: P.t
    }, {
        id: P.QTL5,
        radiusIndex: 3,
        startAngleGrad: 195,
        endAngleGrad: 225,
        quarter: P.t
    }, {
        id: P.QTL7,
        radiusIndex: 3,
        startAngleGrad: 225,
        endAngleGrad: 255,
        quarter: P.t
    }, {
        id: P.QTL8,
        radiusIndex: 4,
        startAngleGrad: 195,
        endAngleGrad: 255,
        quarter: P.t
    }, {
        id: P.QTR0,
        radiusIndex: 0,
        startAngleGrad: 270,
        endAngleGrad: 360,
        quarter: P.l
    }, {
        id: P.QTR3,
        radiusIndex: 1,
        startAngleGrad: 270,
        endAngleGrad: 315,
        quarter: P.l
    }, {
        id: P.QTR1,
        radiusIndex: 1,
        startAngleGrad: 315,
        endAngleGrad: 360,
        quarter: P.l
    }, {
        id: P.QTR6,
        radiusIndex: 2,
        startAngleGrad: 270,
        endAngleGrad: 300,
        quarter: P.l
    }, {
        id: P.QTR4,
        radiusIndex: 2,
        startAngleGrad: 300,
        endAngleGrad: 330,
        quarter: P.l
    }, {
        id: P.QTR2,
        radiusIndex: 2,
        startAngleGrad: 330,
        endAngleGrad: 360,
        quarter: P.l
    }, {
        id: P.QTR7,
        radiusIndex: 3,
        startAngleGrad: 285,
        endAngleGrad: 315,
        quarter: P.l
    }, {
        id: P.QTR5,
        radiusIndex: 3,
        startAngleGrad: 315,
        endAngleGrad: 345,
        quarter: P.l
    }, {
        id: P.QTR8,
        radiusIndex: 4,
        startAngleGrad: 285,
        endAngleGrad: 345,
        quarter: P.l
    }, {
        id: P.QBL0,
        radiusIndex: 0,
        startAngleGrad: 90,
        endAngleGrad: 180,
        quarter: P.i
    }, {
        id: P.QBL3,
        radiusIndex: 1,
        startAngleGrad: 90,
        endAngleGrad: 135,
        quarter: P.i
    }, {
        id: P.QBL1,
        radiusIndex: 1,
        startAngleGrad: 135,
        endAngleGrad: 180,
        quarter: P.i
    }, {
        id: P.QBL6,
        radiusIndex: 2,
        startAngleGrad: 90,
        endAngleGrad: 120,
        quarter: P.i
    }, {
        id: P.QBL4,
        radiusIndex: 2,
        startAngleGrad: 120,
        endAngleGrad: 150,
        quarter: P.i
    }, {
        id: P.QBL2,
        radiusIndex: 2,
        startAngleGrad: 150,
        endAngleGrad: 180,
        quarter: P.i
    }, {
        id: P.QBL7,
        radiusIndex: 3,
        startAngleGrad: 105,
        endAngleGrad: 135,
        quarter: P.i
    }, {
        id: P.QBL5,
        radiusIndex: 3,
        startAngleGrad: 135,
        endAngleGrad: 165,
        quarter: P.i
    }, {
        id: P.QBL8,
        radiusIndex: 4,
        startAngleGrad: 105,
        endAngleGrad: 165,
        quarter: P.i
    }, {
        id: P.QBR0,
        radiusIndex: 0,
        startAngleGrad: 0,
        endAngleGrad: 90,
        quarter: P.o
    }, {
        id: P.QBR1,
        radiusIndex: 1,
        startAngleGrad: 0,
        endAngleGrad: 45,
        quarter: P.o
    }, {
        id: P.QBR3,
        radiusIndex: 1,
        startAngleGrad: 45,
        endAngleGrad: 90,
        quarter: P.o
    }, {
        id: P.QBR2,
        radiusIndex: 2,
        startAngleGrad: 0,
        endAngleGrad: 30,
        quarter: P.o
    }, {
        id: P.QBR4,
        radiusIndex: 2,
        startAngleGrad: 30,
        endAngleGrad: 60,
        quarter: P.o
    }, {
        id: P.QBR6,
        radiusIndex: 2,
        startAngleGrad: 60,
        endAngleGrad: 90,
        quarter: P.o
    }, {
        id: P.QBR5,
        radiusIndex: 3,
        startAngleGrad: 15,
        endAngleGrad: 45,
        quarter: P.o
    }, {
        id: P.QBR7,
        radiusIndex: 3,
        startAngleGrad: 45,
        endAngleGrad: 75,
        quarter: P.o
    }, {
        id: P.QBR8,
        radiusIndex: 4,
        startAngleGrad: 15,
        endAngleGrad: 75,
        quarter: P.o
    }]
      , Ye = [{
        quarter: P.t
    }, {
        quarter: P.l
    }, {
        quarter: P.i
    }, {
        quarter: P.o
    }];
    function en(e) {
        switch (e) {
        case P.t:
            return m.T;
        case P.l:
            return m.L;
        case P.i:
            return m.S;
        case P.o:
            return m.P;
        default:
            return m.T
        }
    }
    function nn(e) {
        switch (e) {
        case P.t:
            return m._;
        case P.l:
            return m.B;
        case P.i:
            return m.q;
        case P.o:
            return m.D;
        default:
            return m._
        }
    }
    function tn(e) {
        return e * (Xe + m.C) + 1
    }
    function rn(e) {
        return tn(e) + Xe
    }
    function an(e) {
        var n = e.x - p
          , t = e.y - p
          , r = Math.sqrt(n * n + t * t);
        let a = Math.atan(t / n) * m.F
          , l = (n < 0 ? a += 180 : 0 < n && t < 0 && (a += 360),
        null);
        for (const u of A) {
            var i = tn(u.radiusIndex) - m.C / 2
              , o = rn(u.radiusIndex) + m.C / 2;
            if (i <= r && r <= o && u.startAngleGrad <= a && a < u.endAngleGrad) {
                l = u.id;
                break
            }
        }
        return l
    }
    function ln(e) {
        for (let t = 0; t < v.length; t++) {
            var n = v[t];
            if (n.H(e))
                return n.quarter
        }
        return null
    }
    function on(e) {
        for (let t = 0; t < v.length; t++) {
            var n = v[t];
            if (n.O(e))
                return n.quarter
        }
        return null
    }
    function un(e, n, t, r) {
        h.beginPath(),
        0 == e ? h.moveTo(p, p) : h.arc(p, p, e, t, r, !1),
        h.arc(p, p, n, r, t, !0),
        h.closePath()
    }
    function sn(e, n) {
        h.beginPath(),
        1 != e && h.moveTo(n.N, n.J),
        h.arc(n.N, n.J, n.V, -90 * m.U, (360 * e - 90) * m.U, !1),
        h.closePath()
    }
    function dn() {
        h.save();
        for (const g of A) {
            let e = 0
              , n = !1;
            var t = Z.find(e=>e.id === g.id);
            t && (e = t.fillPercent,
            n = t.unlocked),
            r = g.radiusIndex,
            a = g.startAngleGrad,
            l = g.endAngleGrad,
            i = g.quarter,
            o = e,
            u = n,
            f = c = d = s = t = void 0,
            t = a * m.U,
            s = l * m.U,
            d = tn(r),
            c = rn(r),
            f = d + o * (c - d),
            f = o < .5 ? Math.ceil(f) : Math.floor(f),
            0 < o && (un(d, f, t, s),
            k(nn(i))),
            u && (un(d, c, t, s),
            k(en(i)))
        }
        var r, a, l, i, o, u, s, d, c, f;
        h.restore()
    }
    function cn() {
        var e, n, t, r;
        h.save(),
        null != j && (e = A.find(e=>e.id === j)) && (n = e.radiusIndex,
        t = e.startAngleGrad,
        r = e.endAngleGrad,
        un(tn(n), rn(n), t * m.U, r * m.U),
        k(m.W)),
        h.restore()
    }
    function fn() {
        var e, n, t, r;
        h.save(),
        null != X && (e = A.find(e=>e.id === X)) && (n = e.radiusIndex,
        t = e.startAngleGrad,
        r = e.endAngleGrad,
        un(tn(n) - m.C / 2, rn(n) + m.C / 2, t * m.U, r * m.U),
        h.lineWidth = m.C,
        h.strokeStyle = "white",
        h.stroke()),
        h.restore()
    }
    function gn() {
        var e = $("#" + ge);
        if (e && e[0]) {
            g = e[0],
            h = g.getContext("2d");
            {
                e = $("#" + ge);
                let t = null
                  , r = null;
                function a() {
                    t = null,
                    r = null
                }
                e.on("contextmenu", function(e) {
                    return kn(e),
                    a(),
                    pn(e),
                    null != X && En(wn(e)),
                    !1
                }),
                e.on("click", function(e) {
                    kn(e),
                    pn(e)
                }),
                e.on("mousemove", function(e) {
                    var n, t, r, a;
                    e = e,
                    n = j,
                    t = Y,
                    r = ne,
                    a = An(e),
                    j = an(a),
                    Y = ln(a),
                    ne = on(a),
                    n === j && t === Y && r === ne || (hn(),
                    Gn(fe, j, Y, ne, !1))
                }),
                e.on("mouseout", function(e) {
                    j = null,
                    Y = null,
                    ne = null,
                    hn()
                }),
                e.on("touchstart", function(e) {
                    e = e.originalEvent || e,
                    DeactivateHelperDiv(),
                    e.touches && 1 == e.touches.length && (t = new Date,
                    r = e.touches[0])
                }),
                e.on("touchmove touchcancel", function() {
                    a()
                }),
                e.on("touchend", function(e) {
                    var n;
                    kn(e),
                    r && t && (pn(r),
                    n = (new Date).getTime() - t.getTime(),
                    null != X) && 500 < n && En(),
                    a()
                })
            }
            re()
        }
    }
    function re() {
        if (ke && we && $e && Ie && be && Ge && Me && Qe && Re && Te && _e && Le && xe && Be && Se && qe && ye && Pe && De && We && 0 < Z.length && 0 < K.length && Ue && g && h) {
            switch (h.save(),
            h.drawImage(ke, 0, 0),
            h.restore(),
            dn(),
            j && cn(),
            h.save(),
            z) {
            case P.Knight:
                vn(90);
                break;
            case P.Sorcerer:
                vn(180);
                break;
            case P.Paladin:
                vn(270);
                break;
            case P.Druid:
            }
            h.drawImage(be, 0, 0),
            h.restore();
            var e = ye.height
              , t = Pe.height
              , l = {};
            l[P.t] = 0,
            l[P.l] = 0,
            l[P.i] = 0,
            l[P.o] = 0,
            h.save();
            for (let n = 0; n < A.length; n++) {
                var i = function(e) {
                    return (e.startAngleGrad + e.endAngleGrad) / 2 * m.U
                }(A[n])
                  , o = function(e) {
                    var n = (tn(e.radiusIndex) + rn(e.radiusIndex)) / 2;
                    return n + (n < rn(0) ? 2 : 0)
                }(A[n])
                  , u = Math.round(Math.cos(i) * o + p - e / 2)
                  , i = Math.round(Math.sin(i) * o + p - e / 2)
                  , o = Z.find(e=>e.id === A[n].id)
                  , r = o.mediumPerkId
                  , s = o.smallPerkId;
                let a = !1;
                if (o.mediumPerkCategory === P.m && 1 === o.fillPercent) {
                    const f = A[n].quarter;
                    var d = K.find(e=>e.id === f);
                    if (d && d.hasGem && d.gemQuality >= l[f]) {
                        a = !0,
                        l[f]++;
                        let e = 0
                          , n = Se
                          , t = De
                          , r = 0;
                        switch (l[f]) {
                        case 1:
                            e = d.keyBasicMod1;
                            break;
                        case 2:
                            e = d.keyBasicMod2;
                            break;
                        case 3:
                            e = d.keySupremeMod,
                            n = qe,
                            t = We,
                            r = -5
                        }
                        var o = n.height
                          , c = t.height;
                        h.drawImage(t, 0, 0, c, c, u - 1, i - 1, c, c),
                        h.drawImage(n, e * o, 0, o, o, u, i + r, o, o)
                    }
                }
                a || h.drawImage(ye, r * e, 0, e, e, u, i, e, e),
                h.drawImage(Pe, s * t, 0, t, t, u - 3, i + 17, t, t)
            }
            if (h.restore(),
            v.length !== Ye.length) {
                v = [];
                let a = 0;
                Ye.forEach(n=>{
                    var e = K.find(e=>e.id === n.quarter)
                      , t = en(n.quarter)
                      , r = nn(n.quarter);
                    switch (n.quarter) {
                    case P.t:
                        a = 180;
                        break;
                    case P.l:
                        a = 270;
                        break;
                    case P.i:
                        a = 90;
                        break;
                    default:
                        P.o;
                        a = 0
                    }
                    e = new Hn(e,t,r,a);
                    v.push(e)
                }
                )
            } else
                v.forEach(n=>{
                    var e = K.find(e=>e.id === n.quarter);
                    e && (n.largePerkId = e.largePerkId,
                    n.level = e.level,
                    n.fillPercent = e.fillPercent,
                    n.vesselLevel = e.vesselLevel,
                    n.hasGem = e.hasGem,
                    n.gemQuality = e.gemQuality,
                    n.socketBezelImgId = e.socketBezelImgId,
                    n.gemImgId = e.gemImgId)
                }
                );
            v.forEach(e=>{
                let n = Ge;
                switch (e.level) {
                case 0:
                    n = Ge;
                    break;
                case 1:
                    n = Me;
                    break;
                case 2:
                    n = Qe;
                    break;
                default:
                    n = Re
                }
                let t = we
                  , r = (0 < e.vesselLevel && (t = $e),
                0);
                switch (e.quarter) {
                case P.t:
                    r = 0;
                    break;
                case P.l:
                    r = 90;
                    break;
                case P.o:
                    r = 180;
                    break;
                case P.i:
                    r = 270;
                    break;
                default:
                    r = 0
                }
                var a, l, i;
                h.save(),
                r && vn(r),
                e.quarter != P.l && e.quarter != P.i || mn(t),
                h.drawImage(t, 0, 0),
                h.restore(),
                h.save(),
                sn((o = e).fillPercent, o),
                k(o.Z),
                sn(1, o),
                k(o.K),
                h.restore(),
                h.save(),
                a = ((o = e).j + 40) * m.U,
                l = (o.j + 50) * m.U,
                h.beginPath(),
                h.arc(p, p, o.X, a, l, !1),
                h.arc(p, p, o.Y, l, a, !0),
                h.closePath(),
                k(o.Z),
                k(o.Z),
                k(o.Z),
                h.restore(),
                (o = e).quarter === Y && (h.save(),
                sn(1, o),
                k(m.W),
                h.restore()),
                (o = e).quarter === ne && (h.save(),
                h.beginPath(),
                h.arc(o.ee, o.ne, o.te, 0 * m.U, 360 * m.U, !1),
                h.closePath(),
                k(m.W),
                h.restore());
                h.save(),
                r && vn(r),
                h.globalAlpha = .4,
                h.drawImage(Ie, 0, 0),
                h.restore(),
                h.save(),
                r && vn(r),
                e.quarter != P.l && e.quarter != P.i || mn(n),
                h.drawImage(n, 0, 0),
                h.restore(),
                o = e,
                l = Te.height,
                a = l / 2,
                i = o.N - a,
                a = o.J - a,
                h.save(),
                h.drawImage(Te, o.largePerkId * l, 0, l, l, i, a, l, l),
                h.restore();
                var o = e
                  , o = (o.quarter === ee && (h.save(),
                i = Math.round(o.N - o.V + 1),
                a = Math.round(o.J - o.V + 1),
                h.drawImage(_e, i, a),
                h.restore()),
                e)
                  , o = (o.hasGem && (l = Le.height,
                a = o.ee - (i = l / 2),
                i = o.ne - i,
                h.save(),
                h.drawImage(Le, o.gemImgId * l, 0, l, l, a, i, l, l),
                h.restore()),
                o = e,
                a = xe.height,
                i = a / 2,
                l = o.ee - i,
                i = o.ne - i,
                h.save(),
                h.drawImage(xe, o.socketBezelImgId * a, 0, a, a, l, i, a, a),
                h.restore(),
                e);
                o.quarter === te && (h.save(),
                l = Math.round(o.ee - o.te - 1),
                i = o.quarter === P.t || o.quarter === P.l ? -2 : 0,
                i = Math.round(o.ne - o.te + i),
                h.drawImage(Be, l, i),
                h.restore())
            }
            ),
            X && fn()
        }
    }
    function hn() {
        g && h && (h.clearRect(0, 0, g.width, g.height),
        re())
    }
    function k(e) {
        h.fillStyle = e,
        h.globalCompositeOperation = "lighter",
        h.mozFillRule = "evenodd",
        h.fill("evenodd")
    }
    function vn(e) {
        h.translate(p, p),
        h.rotate(e * m.U),
        h.translate(-p, -p)
    }
    function mn(e) {
        h.translate(e.height / 2, e.width / 2),
        h.rotate(-90 * m.U),
        h.scale(-1, 1),
        h.translate(-e.width / 2, -e.height / 2)
    }
    function pn(e) {
        var n = X
          , t = ee
          , r = te
          , a = An(e);
        X = an(a),
        ee = ln(a),
        te = on(a),
        n === X && t === ee && r === te || (j === X && Y === ee && ne === te || (j = X,
        Y = ee,
        ne = te,
        Gn(fe, j, Y, ne, !1)),
        hn(),
        Gn(N, X, ee, te, !0))
    }
    function An(e) {
        var n = g.getBoundingClientRect();
        return {
            x: e.clientX - n.left,
            y: e.clientY - n.top
        }
    }
    function kn(e) {
        e.cancelable && e.preventDefault(),
        e.stopPropagation()
    }
    function wn(n) {
        if (n.altKey || n.shiftKey || n.ctrlKey) {
            let e = 1;
            return n.shiftKey && (e *= 10),
            n.ctrlKey && (e *= 100),
            e
        }
        return 0
    }
    function $n(e) {
        return /^$|^[-_.~a-zA-Z0-9]{3,90}$/.test(e)
    }
    function In(n) {
        var e = $("#" + a + "_" + n);
        e && e[0] && (n === z && (e[0].setAttribute("checked", "checked"),
        e.prop("checked", !0)),
        e[0].addEventListener("click", function() {
            var e;
            (e = n) !== z && s(!1, null, "setVocation", u.get(e))
        }))
    }
    function bn(n) {
        if (n && n[0]) {
            let e = n.val().trim();
            var t = e.match(/code=([-_.~a-zA-Z0-9]+)/);
            $n(e = t ? t[1] : e) ? (n.val(e),
            Wn(e)) : (ae(se),
            ae(ce))
        }
    }
    function ae(e) {
        var n = $("#" + e);
        n && n[0] && n[0].classList.remove("hide")
    }
    function le(e) {
        var n = $("#" + e);
        return n && n[0] && (n[0].classList.add("hide"),
        1)
    }
    function D(e) {
        var n = $("#" + e);
        n && n[0] && n[0].classList.remove("Locked")
    }
    function W(e) {
        var n = $("#" + e);
        n && n[0] && n[0].classList.add("Locked")
    }
    function ie(e, n, t, r, a) {
        var l = $("#" + e);
        l && l[0] && (t ? l.html(n) : l.text(n),
        r) && qn(l[0], a, r)
    }
    function Gn(e, n, t, r, a) {
        if (y) {
            var l = e + "-empty"
              , i = e + "-large"
              , o = e + "-medium"
              , u = e + "-dedication"
              , s = e + "-conviction"
              , d = e + "-revelation"
              , c = e + "-buttons"
              , f = e + "-socket"
              , g = e + "-gem"
              , h = e + "-vessel";
            if (null != n) {
                le(l),
                le(i),
                le(f);
                var v = Z.find(e=>e.id === n);
                if (v) {
                    Mn(e, v);
                    var m = u
                      , p = s
                      , A = v
                      , k = a;
                    if (A) {
                        var w, I, b, G, u = m + "-value", s = y.SmallPerkInfos[A.smallPerkId];
                        let e = ""
                          , n = "";
                        A.smallPerkHasSecondaryEffect ? (T = y.SmallPerkInfos[0],
                        w = y.SmallPerkInfos[1],
                        b = U(T.Name),
                        M = U(w.Name),
                        I = C(T.FormatType, A.smallPerkPrimaryEffectValue),
                        G = C(w.FormatType, A.smallPerkSecondaryEffectValue),
                        I = "" + I + b,
                        G = "" + G + M,
                        e = I + "<br>" + G,
                        k && (I = C(T.FormatType, A.smallPerkPrimaryEffectIncrease),
                        G = C(w.FormatType, A.smallPerkSecondaryEffectIncrease),
                        T = "" + I + b,
                        w = "" + G + M,
                        n = T + "<br>" + w)) : (I = U(s.Name),
                        b = C(s.FormatType, A.smallPerkPrimaryEffectValue),
                        e = "" + b + I,
                        k && (G = C(s.FormatType, A.smallPerkPrimaryEffectIncrease),
                        n = "" + G + I)),
                        k && (n = y.SmallPerkInfos.PerSmallPerkCaption + "<br>" + n,
                        s.LongInfo) && (n = s.LongInfo + "<br><br>" + n),
                        ie(u, e, !0),
                        (0 === A.currentSkillPoints ? W : D)(u),
                        Rn(m, y.SmallPerkInfos, "", n);
                        var M = p + "-value"
                          , Q = y.MediumPerkInfos[A.mediumPerkId];
                        let t = ""
                          , r = "";
                        switch (A.mediumPerkCategory) {
                        case P.v:
                            t = U(Q.Name) + "<br>",
                            t += Pn(A.mediumPerkValue, Q, !0),
                            k && (r = y.MediumPerkInfos.AugGeneralInfo);
                            break;
                        case P.h:
                            var R = C(Q.FormatType, A.mediumPerkValue);
                            t = "" + R + U(Q.Name),
                            k && (r = y.MediumPerkInfos.GeneralInfo);
                            break;
                        case P.g:
                            t = C(Q.FormatType, A.mediumPerkValue),
                            t = (t += U(Q.Name) + "<br>") + Q.LongInfo,
                            k && (r = y.MediumPerkInfos.GeneralInfo);
                            break;
                        case P.u:
                            R = Dn(Q.LongInfo);
                            t = U(Q.Name) + "<br>",
                            t = (t += `<span title="${R}">`) + R + "</span>",
                            k && (r = y.MediumPerkInfos.GeneralInfo);
                            break;
                        case P.m:
                            t = U(Q.Name) + "<br>",
                            t += Q.LongInfo,
                            k && (r = y.MediumPerkInfos.GeneralInfo);
                            break;
                        default:
                            P.p;
                            t = U(Q.Name) + "<br>",
                            t += Dn(Q.LongInfo),
                            k && (r = y.MediumPerkInfos.GeneralInfo)
                        }
                        ie(M, t, !0),
                        (!(A.mediumPerkCategory === P.v && 1 <= A.mediumPerkValue) && A.fillPercent < 1 ? W : D)(M),
                        Rn(p, y.MediumPerkInfos, "", r)
                    }
                    ae(o),
                    (v.unlocked && v.editable ? ae : le)(c)
                }
            } else if (null != t) {
                le(l),
                le(o),
                le(f);
                var T = K.find(e=>e.id === t);
                T && (Mn(e, T),
                m = d,
                p = a,
                (L = T) && (w = m + "-name",
                s = m + "-description",
                u = `(${y.LargePerkLevelNames[L.level]})`,
                v = y.LargePerkInfos,
                c = v[L.largePerkId],
                d = U(c.Name),
                S = p ? v.GeneralInfo : "",
                Tn(m, Te, L.largePerkId, ["LargePerkIcon"]),
                _ = p ? c.LongInfoPerLevel[L.level] : "",
                ie(w, d, !1, _, d),
                ie(s, c.ShortInfo),
                (0 === L.level ? (W(w),
                W(s),
                W) : (D(w),
                D(s),
                D))(m + "-icon"),
                Rn(m, v, u, S)),
                ae(i))
            } else if (null != r) {
                Mn(e, null),
                le(l),
                le(o),
                le(i);
                var _ = K.find(e=>e.id === r);
                if (_) {
                    var L = g
                      , x = h
                      , B = _;
                    if (B) {
                        d = y.BasicModEffectInfos,
                        c = y.SupremeModInfos,
                        s = y.VesselInfos;
                        if (d && c && s) {
                            var u = L + "-name"
                              , S = L + "-modgrades"
                              , g = L + "-mod1"
                              , h = L + "-mod2"
                              , q = L + "-mod3";
                            let e = 0
                              , n = s.NoGemInVesselInfo
                              , t = (B.hasGem && (e = B.gemQuality + 1,
                            n = s.GemNames[B.gemQuality][z]),
                            "");
                            a && (t = s.GemInfo + "<br><br>All mods shown in the Wheel of Destiny Planner have their grade set to a maximum of IV."),
                            ie(u, n, !1, t, n),
                            !function(e, n) {
                                for (let r = 0; r < 3; r++) {
                                    var t = $(`#${e}-` + (r + 1));
                                    t && t[0] && (r < n ? t[0].classList.remove("hide") : t[0].classList.add("hide"))
                                }
                            }(S, e),
                            xn(g, B.keyBasicMod1, B.valueBasicMod1, d),
                            xn(h, B.keyBasicMod2, B.valueBasicMod2, d),
                            !function(n, t, e) {
                                if (t < 0)
                                    ie(n, "");
                                else {
                                    var r = e[t];
                                    if (r) {
                                        let e = r.EffectInfo[3];
                                        r.Name && (e = U(r.Name, !0) + "<br>" + e),
                                        -1 === ze.indexOf(t) && (e = `<div class="InvalidMod ColorRed">${e}</div>`),
                                        ie(n, e, !0)
                                    } else
                                        ie(n, "")
                                }
                            }(q, B.keySupremeMod, c),
                            Tn(g, Se, B.keyBasicMod1, ["ModIcon"]),
                            Tn(h, Se, B.keyBasicMod2, ["ModIcon"]),
                            Tn(q, qe, B.keySupremeMod, ["ModIcon", "SupremeMod"]),
                            (0 < B.vesselLevel ? (D(g),
                            D) : (W(g),
                            W))(g + "-icon"),
                            (1 < B.vesselLevel ? (D(h),
                            D) : (W(h),
                            W))(h + "-icon"),
                            (2 < B.vesselLevel ? (D(q),
                            D) : (W(q),
                            W))(q + "-icon"),
                            _n(g + "-dropdown", 1, e, B.keyBasicMod1, [B.keyBasicMod2]),
                            _n(h + "-dropdown", 2, e, B.keyBasicMod2, [B.keyBasicMod1]),
                            _n(q + "-dropdown", 3, e, B.keySupremeMod);
                            u = x + "-header",
                            S = x + "-value",
                            d = s.VesselActivation[B.vesselLevel],
                            c = a ? s.VesselInfo : "";
                            ie(u, d, !1, c, d),
                            s.ExtraDamageHealingDisplayName ? (g = `+${B.vesselDamageHealingBonus} ` + s.ExtraDamageHealingDisplayName,
                            ie(S, g)) : ie(S, ""),
                            (B.hasGem && B.vesselLevel === e ? D : W)(S)
                        }
                    }
                    ae(f)
                }
            } else
                Mn(e, null),
                le(o),
                le(i),
                le(f),
                ae(l)
        }
    }
    function Mn(e, n) {
        var t, r, a, l, i, o = e + "-bar";
        (n ? (l = o + "-filling",
        t = o + "-text",
        r = n.maxSkillPoints || 0,
        a = Math.min(n.currentSkillPoints || 0, r),
        (l = $("#" + l)) && l[0] && (i = 0 === r ? 0 : Math.round(a / r * 1e3) / 10,
        l[0].style.width = i + "%"),
        ie(t, a + "/" + r),
        ae) : le)(o)
    }
    function Qn(e, n) {
        var t = $("#" + a + "_" + e);
        t && t[0] && (t[0].checked = n)
    }
    function Rn(e, n, t, r) {
        var a = $("#" + e + "-header");
        if (a && a[0] && n && n.DisplayName) {
            a.empty();
            let e = n.DisplayName;
            t && (e = e + " " + t),
            a.text(e),
            r && qn(a[0], n.DisplayName, r)
        }
    }
    function Tn(e, n, t, r=[]) {
        var a = $("#" + e + "-icon");
        if (a && a[0] && (a.empty(),
        n)) {
            var l, i = n.height;
            a[0].style = `min-width: ${i}px; max-width: ${i}px; height: ${i}px;`;
            for (let e = 0; e < r.length; e++)
                a[0].classList.add(r[e]);
            -1 < t && ((l = document.createElement("img")).setAttribute("src", n.getAttribute("src")),
            l.style = `margin-left: -${t * i}px;`,
            a[0].appendChild(l))
        }
    }
    function _n(e, r, n, l, i=[]) {
        const o = $(`select[name="${e}"]`);
        if (o && o[0]) {
            o.empty();
            const d = y.BasicModEffectInfos
              , c = y.SupremeModInfos;
            let t = null;
            if (n <= r && ((t = document.createElement("option")).setAttribute("value", -1),
            t.textContent = "(no Mod)",
            o[0].appendChild(t)),
            n + 1 < r)
                o[0].setAttribute("disabled", !0);
            else {
                o[0].removeAttribute("disabled");
                let a = !1;
                if (3 === r) {
                    if (ze.sort((e,n)=>{
                        var t = c[e]
                          , r = c[n];
                        return t.SummaryPriority !== r.SummaryPriority ? t.SummaryPriority - r.SummaryPriority : t.NameSummary > r.NameSummary ? 1 : -1
                    }
                    ),
                    ze.forEach(n=>{
                        var t = c[n];
                        if (t && (!i.includes(n) || n === l)) {
                            var r = document.createElement("option");
                            r.setAttribute("value", n);
                            let e = t.EffectInfo[3];
                            t.Name && (e = `${U(t.Name, !0)} (${e})`),
                            r.textContent = e,
                            a || n !== l || (a = !0,
                            r.setAttribute("selected", !0)),
                            o[0].appendChild(r)
                        }
                    }
                    ),
                    !a)
                        if (-1 < l) {
                            var u = c[l];
                            if (u) {
                                var s = document.createElement("option");
                                s.setAttribute("value", l);
                                let e = u.EffectInfo[3];
                                u.Name && (e = `${U(u.Name, !0)} (${e})`),
                                s.textContent = e,
                                s.setAttribute("selected", !0),
                                o[0].appendChild(s)
                            }
                        } else
                            t && t.setAttribute("selected", !0)
                } else {
                    let e = []
                      , n = [];
                    1 === r ? (e = Je,
                    n = Ve) : 2 === r && (e = Ve,
                    n = Je),
                    (e = -1 < l && !e.find(e=>e.id === l) && (u = n.find(e=>e.id === l)) ? e.concat(u) : e).forEach(e=>{
                        var n, t;
                        i.includes(e.id) && e.id !== l || (n = Ln(e.effects, d)).length && ((t = document.createElement("option")).setAttribute("value", e.id),
                        t.textContent = n.join(" / "),
                        a || e.id !== l || (a = !0,
                        t.setAttribute("selected", !0)),
                        o[0].appendChild(t))
                    }
                    ),
                    !a && t && t.setAttribute("selected", !0)
                }
            }
        }
    }
    function Ln(e, n) {
        if (!e || !e.length || !n)
            return [];
        var t = [];
        for (let i = 0; i < e.length; i++) {
            var r, a = e[i].id, l = e[i].value, a = n[a];
            a && (r = (r = "") + yn(a.FormatType, l) + U(a.Name),
            t.push(r))
        }
        return t
    }
    function xn(e, n, t, r) {
        var a;
        !(n < 0) && (a = Ln(t, r)).length ? ie(e, a.join("<br>"), !0) : ie(e, "")
    }
    function Bn() {
        if (y) {
            let e = [];
            const I = y.SmallPerkInfos
              , b = (I && (e = Fe.map(e=>{
                var n = I[e.id]
                  , t = {};
                return t.name = U(n.Name),
                t.value = C(n.FormatType, e.value),
                t.re = t.name,
                t.ae = n.LongInfo,
                t
            }
            )),
            []);
            var t, r, a, l, i = y.MediumPerkInfos;
            if (i) {
                for (let e = 0; e < He.length; e++) {
                    var o, u, s = He[e];
                    0 !== s.value && (o = i[s.id]) && (u = s.category === P.v ? Pn(s.value, o) : o.LongInfo,
                    t = s,
                    a = U((r = o).Name),
                    l = u,
                    (s = {}).name = a,
                    s.value = C(r.FormatType, t.value),
                    s.re = a,
                    s.ae = l,
                    s.priority = r.SummaryPriority,
                    b.push(s))
                }
                b.sort((e,n)=>e.priority !== n.priority ? e.priority - n.priority : e.name > n.name ? 1 : -1)
            }
            let n = [];
            const G = y.LargePerkInfos
              , M = (G && ((n = K.map(e=>{
                var n = G[e.largePerkId]
                  , t = {};
                return t.name = U(n.Name),
                t.value = y.LargePerkLevelNames[e.level],
                t.re = t.name,
                t.ae = n.LongInfoPerLevel[e.level],
                t
            }
            )).sort((e,n)=>e.name > n.name ? 1 : -1),
            (m = {}).name = G.ExtraDamageHealingDisplayName,
            m.value = "+" + Ze,
            m.re = m.name,
            m.ae = G.ExtraDamageHealingInfo,
            n.unshift(m)),
            []);
            var d, c, f, g, h = y.BasicModEffectInfos, v = y.SupremeModInfos, m = y.VesselInfos;
            if (h && v && m) {
                function p(e, n, t, r, a) {
                    var l = {};
                    l.name = t,
                    l.value = yn(n.FormatType, e),
                    l.re = t,
                    l.ae = r || "",
                    l.priority = n.SummaryPriority,
                    a && (l.icon = a),
                    M.push(l)
                }
                for (let e = 0; e < Oe.length; e++) {
                    var A, k = Oe[e];
                    0 !== k.value && (A = h[k.id]) && p(k.value, A, U(A.Name), A.LongInfo)
                }
                for (let n = 0; n < Ne.length; n++) {
                    var w = Ne[n];
                    if (0 !== w.value) {
                        var $ = v[w.id];
                        if ($) {
                            let e = "";
                            switch (w.category) {
                            case P.k:
                                e = Q;
                                break;
                            case P.$:
                                e = R;
                                break;
                            case P.I:
                            case P.G:
                                e = T
                            }
                            p(w.value, $, U($.NameSummary), (c = $.EffectInfoSummary,
                            f = w.value,
                            g = $.FormatType,
                            c ? c.replaceAll("<ReplaceMe>", 0 <= g.indexOf("FromInt") ? f / 100 : f) : ""), e)
                        }
                    }
                }
                0 < je && ((d = {}).name = m.MomentumName,
                d.value = yn(m.MomentumFormat, je),
                d.re = d.name,
                d.ae = m.MomentumTooltip,
                d.priority = m.MomentumSummaryPriority,
                M.push(d)),
                M.sort((e,n)=>e.priority !== n.priority ? e.priority - n.priority : e.name > n.name ? 1 : -1),
                0 < Ke && ((d = {}).name = m.ExtraDamageHealingDisplayName,
                d.value = "+" + Ke,
                d.re = d.name,
                d.ae = m.VesselInfo,
                M.unshift(d))
            }
            Sn(he, e),
            Sn(ve, b),
            Sn(me, n),
            Sn(pe, M)
        }
    }
    function Sn(e, n) {
        var t, r, a = $("#" + e);
        if (a && a[0])
            if (a.empty(),
            0 === n.length)
                (t = document.createElement("tr")).classList.add("Even"),
                (r = document.createElement("td")).setAttribute("colspan", 2),
                r.textContent = "none",
                t.appendChild(r),
                a[0].appendChild(t);
            else
                for (i = 0; i < n.length; i++) {
                    var l = n[i]
                      , o = document.createElement("tr")
                      , u = (o.classList.add(i % 2 ? "Odd" : "Even"),
                    document.createElement("td"))
                      , s = document.createElement("span");
                    let e = l.name;
                    l.icon && ((d = document.createElement("img")).className = "ModAugIcon",
                    d.src = l.icon,
                    s.appendChild(d),
                    e = (e = e.replace("Aug. ", "")).replace("Augmented ", ""));
                    var d = document.createTextNode(e)
                      , c = (s.appendChild(d),
                    document.createElement("td"))
                      , f = document.createElement("span");
                    f.textContent = l.value,
                    f.classList.add("PerksSummaryValue"),
                    u.appendChild(s),
                    c.appendChild(f),
                    qn(c, l.re, l.ae),
                    o.appendChild(u),
                    o.appendChild(c),
                    a[0].appendChild(o)
                }
    }
    function qn(e, n, t) {
        if (e && t) {
            e.style.position = "relative";
            const i = `<p>${function(e) {
                letn = "";
                return n = (n = e.replace(/<font color='#ffffff'>(.*?)<\/font>/gi, '<span class="Highlight">$1</span>')).replace(/<\/?font[^>]*>/gi, "")
            }(t)}</p>`;
            var r = document.createElement("div")
              , a = (r.classList.add("PerkTooltipContainer"),
            document.createElement("span"))
              , l = (a.classList.add("HelperDivIndicator"),
            a.addEventListener("mouseover", function() {
                var e = $("#HelperDivText");
                e && e[0] && e[0].classList.add("LeftAlign"),
                ActivateHelperDiv($(this), n, i, "")
            }),
            a.addEventListener("mouseout", function() {
                var e = $("#HelperDivText");
                e && e[0] && e[0].classList.remove("LeftAlign"),
                DeactivateHelperDiv()
            }),
            document.createElement("img"));
            l.src = d,
            l.setAttribute("alt", "tooltip icon"),
            a.appendChild(l),
            r.appendChild(a),
            e.appendChild(r)
        }
    }
    function C(e, n) {
        switch (e) {
        case "NoEffectDisplay":
            return "";
        case "PlusInteger":
            return `+${n.toLocaleString("en-US")} `;
        case "PlusFullPercent":
        case "PlusPercentWithTwoFloatingpoints":
            return 0 === n ? "+0% " : n < 0 ? (n / 100).toFixed(2).toLocaleString("en-US") + "% " : `+${(n / 100).toFixed(2).toLocaleString("en-US")}% `;
        case "PercentWithTwoFloatingpoints":
            return 0 === n ? "0% " : (n / 100).toFixed(2).toLocaleString("en-US") + "% ";
        case "RomanNumerals":
            return toRomanNumeral(n) + " "
        }
        return n + " "
    }
    function yn(e, n) {
        switch (e) {
        case "PlusInteger":
            return `+${n.toLocaleString("en-US")} `;
        case "PercentWithTwoFloatingpoints":
            return 0 === n ? "0% " : (Math.round(100 * n) / 100).toLocaleString("en-US") + "% ";
        case "PlusPercentWithTwoFloatingpoints":
            return 0 === n ? "0% " : n < 0 ? (Math.round(100 * n) / 100).toFixed(2).toLocaleString("en-US") + "% " : `+${(Math.round(100 * n) / 100).toFixed(2).toLocaleString("en-US")}% `;
        case "PlusPercentWithUpToTwoFloatingpoints":
            return 0 === n ? "+0% " : n < 0 ? (Math.round(100 * n) / 100).toLocaleString("en-US") + "% " : `+${(Math.round(100 * n) / 100).toLocaleString("en-US")}% `;
        case "PlusPercentWithUpToTwoFloatingpointsFromInt":
            return 0 === n ? "+0% " : n < 0 ? (n / 100).toLocaleString("en-US") + "% " : `+${(n / 100).toLocaleString("en-US")}% `;
        case "RomanNumerals":
            return toRomanNumeral(n) + " ";
        case "Seconds":
            return n + "s"
        }
        return n + " "
    }
    function U(e, n) {
        var t;
        return "string" != typeof e ? "" : (t = e.split("|"),
        n && 1 < t.length ? t[1] : t[0])
    }
    function Pn(e, n, t) {
        var r = 1 <= e
          , a = 2 <= e
          , l = `<img src="${c}1-${r ? "active" : "inactive"}.png">`
          , i = `<img src="${c}2-${a ? "active" : "inactive"}.png">`
          , o = t ? ` title="${n.Aug1Info}"` : ""
          , u = t ? ` title="${n.Aug2Info}"` : "";
        return `<table><tr>${`<td class="AugIcon">${l}:</td>`}${`<td class="AugText${t ? " Abbr" : ""}">${`<span ${`class="${r ? "Unlocked" : "Locked"}"`}${o}>${n.Aug1Info}</span>`}</td>`}</tr><tr>${`<td class="AugIcon">${i}:</td>`}${`<td class="AugText${t ? " Abbr" : ""}">${`<span ${`class="${a ? "Unlocked" : "Locked"}"`}${u}>${n.Aug2Info}</span>`}</td>`}</tr></table>`
    }
    function Dn(e) {
        return e.replaceAll("/", " / ")
    }
    function s(d, e, c, ...f) {
        if (d || Ue) {
            Ee = !0;
            let s = e;
            var n;
            J || (n = u.get(z),
            J = new Ce.SkillwheelPlanner(n),
            s = s || H);
            try {
                "string" == typeof s && ($n(s = s.trim()) && J.updateByCode(s) || d ? (le(se),
                le) : (ae(se),
                ae))(ce),
                c && "function" == typeof J[c] && J[c](...f),
                Z = [];
                var g = J.getSkillParameters();
                for (let e = 0; e < g.size(); e++) {
                    var h = g.get(e);
                    h.id = V.get(h.id),
                    h.mediumPerkCategory = V.get(h.mediumPerkCategory),
                    Z.push(h)
                }
                K = [];
                var v = J.getCornerParameters();
                for (let n = 0; n < v.size(); n++) {
                    var m = v.get(n);
                    if (m.id = V.get(m.id),
                    m.valueBasicMod1) {
                        var p = [];
                        for (let e = 0; e < m.valueBasicMod1.size(); e++) {
                            var A = m.valueBasicMod1.get(e);
                            p.push(A)
                        }
                        m.valueBasicMod1 = p
                    } else
                        m.valueBasicMod1 = [];
                    if (m.valueBasicMod2) {
                        var k = [];
                        for (let e = 0; e < m.valueBasicMod2.size(); e++) {
                            var w = m.valueBasicMod2.get(e);
                            k.push(w)
                        }
                        m.valueBasicMod2 = k
                    } else
                        m.valueBasicMod2 = [];
                    K.push(m)
                }
                Ze = J.getGridDamageAndHealingBonus(),
                Ke = J.getVesselsDamageAndHealingBonus(),
                je = J.getVesselsMomentumBonus(),
                Fe = [];
                var $ = J.getSmallPerksSummary();
                for (let t = 0; t < $.size(); t++) {
                    var I = $.get(t);
                    Fe.push(I)
                }
                He = [];
                var b = J.getMediumPerksSummary();
                for (let r = 0; r < b.size(); r++) {
                    var G = b.get(r);
                    G.category = V.get(G.category),
                    He.push(G)
                }
                Oe = [];
                var M = J.getGemsBasicModEffectSummary();
                for (let a = 0; a < M.size(); a++) {
                    var Q = M.get(a);
                    Oe.push(Q)
                }
                Ne = [];
                var R = J.getGemsSupremeModSummary();
                for (let l = 0; l < R.size(); l++) {
                    var T = R.get(l);
                    T.category = V.get(T.category),
                    Ne.push(T)
                }
                var _ = J.getVocation()
                  , L = V.get(_)
                  , x = (L !== z && (Qn(z, !1),
                Qn(L, !0),
                z = L),
                Je = [],
                J.getAvailableBasicModsPos1());
                for (let i = 0; i < x.size(); i++) {
                    var B = x.get(i);
                    if (B.effects) {
                        var S = [];
                        for (let e = 0; e < B.effects.size(); e++) {
                            var q = B.effects.get(e);
                            S.push(q)
                        }
                        B.effects = S
                    } else
                        B.effects = [];
                    Je.push(B)
                }
                Ve = [];
                var y = J.getAvailableBasicModsPos2();
                for (let o = 0; o < y.size(); o++) {
                    var P = y.get(o);
                    if (P.effects) {
                        var D = [];
                        for (let e = 0; e < P.effects.size(); e++) {
                            var W = P.effects.get(e);
                            D.push(W)
                        }
                        P.effects = D
                    } else
                        P.effects = [];
                    Ve.push(P)
                }
                ze = [];
                var C = J.getAvailableSupremeMods();
                for (let u = 0; u < C.size(); u++) {
                    var U = C.get(u);
                    ze.push(U)
                }
                var E = J.getCode()
                  , F = (E !== H && $n(E) && (H = E,
                ie(ue, H),
                ie(de, H),
                history.replaceState(null, null, "?subtopic=wheelofdestinyplanner&code=" + H),
                Gn(N, X, ee, te, !0),
                Gn(fe, j, Y, ne, !1),
                Bn()),
                J.getSpentSkillPoints());
                F !== O && (O = F,
                ie(oe, O)),
                (d ? (Ue = !0,
                re) : hn)(),
                Ee = !1
            } catch (t) {
                J["delete"](),
                J = null,
                Ee = !1
            }
        }
    }
    function Wn(e) {
        e === H ? (le(se),
        le(ce)) : s(!1, e)
    }
    function Cn(n) {
        var t = Z.find(e=>e.id === X);
        if (t && 1 != t.fillPercent && t.unlocked) {
            t = u.get(X);
            let e = n || 1;
            0 < (e = null != o ? Math.min(e, o - O) : e) && s(!1, null, "addToSkill", t, e)
        }
    }
    function Un(e) {
        var n = Z.find(e=>e.id === X);
        n && 0 != n.fillPercent && n.editable && s(!1, null, "removeFromSkill", u.get(X), e || 1)
    }
    function En(n) {
        var t = Z.find(e=>e.id === X);
        if (t) {
            let e = n || 0;
            s(!1, null, "onGridTileRightClicked", u.get(X), e = null != o ? O >= o ? -1 : 0 < e ? Math.min(e, o - O) : (t = t.maxSkillPoints - t.currentSkillPoints,
            Math.min(t, o - O)) : e)
        }
    }
    function Fn(e, n) {
        var t;
        Ee || (t = u.get(te)) && s(!1, null, "onModChange", e, n, t)
    }
    class Hn {
        constructor(e, n, t, r) {
            this.quarter = e.id,
            this.largePerkId = e.largePerkId,
            this.level = e.level,
            this.fillPercent = e.fillPercent,
            this.vesselLevel = e.vesselLevel,
            this.hasGem = e.hasGem,
            this.gemQuality = e.gemQuality,
            this.socketBezelImgId = e.socketBezelImgId,
            this.gemImgId = e.gemImgId,
            this.K = n,
            this.Z = t,
            this.j = r,
            this.X = 270,
            this.Y = 285,
            this.le = 311,
            this.V = 25,
            this.ie = 287,
            this.te = 17,
            this.oe = this.quarter == P.l || this.quarter == P.i ? 34 : 56,
            this.N = Math.round(Math.cos((this.j + 45) * m.U) * this.le) + p,
            this.J = Math.round(Math.sin((this.j + 45) * m.U) * this.le) + p,
            this.ee = Math.round(Math.cos((this.j + this.oe) * m.U) * this.ie) + p,
            this.ne = Math.round(Math.sin((this.j + this.oe) * m.U) * this.ie) + p
        }
        H(e) {
            var n = this.N - e.x
              , t = this.J - e.y;
            return Math.sqrt(n * n + t * t) <= this.V
        }
        O(e) {
            var n = this.ee - e.x
              , t = this.ne - e.y;
            return Math.sqrt(n * n + t * t) <= this.te
        }
    }
    if ((e = e) && (n = e.warning,
    r = e.wrapper,
    a = e.vocationRadio,
    oe = e.reqPoints,
    l = e.limitPoints,
    ue = e.code,
    f = e.codeCopy,
    w = e.codeUrl,
    I = e.codeImport,
    b = e.codeReset,
    G = e.codeInput,
    se = e.codeInvalid,
    de = e.codeMobile,
    M = e.codeCopyMobile,
    _ = e.codeUrlMobile,
    L = e.codeImportMobile,
    x = e.codeResetMobile,
    B = e.codeInputMobile,
    ce = e.codeInvalidMobile,
    N = e.selectionBox,
    S = e.maxMinus,
    q = e.minus,
    E = e.maxPlus,
    F = e.plus,
    fe = e.infoBox,
    ge = e.canvas,
    he = e.dedicationPerks,
    ve = e.convictionPerks,
    me = e.revelationPerks,
    pe = e.gemPerks,
    Ae = e.summaryNote,
    n) && r && a && oe && l && ue && f && w && I && b && G && se && de && M && _ && L && x && B && ce && N && S && q && E && F && fe && ge && he && ve && me && pe && Ae && le(n)) {
        var On = window.navigator.userAgent;
        if (!On || 0 < On.indexOf("MSIE ") || 0 < On.indexOf("Trident/"))
            ie(n, "If you are using Internet Explorer, you won't be able to use the Wheel of Destiny Planner. Please use a different browser!"),
            ae(n);
        else {
            var On = new URLSearchParams(window.location.search).get("code")
              , On = $n(On) ? On : null
              , Nn = 1 < (Nn = t.split("version=")).length ? "?version=" + Nn[1] : ""
              , Jn = (d = JS_DIR_IMAGES + "global/content/info.gif",
            c = JS_DIR_IMAGES + "community/wheelofdestiny/icon-augmentation",
            T = JS_DIR_IMAGES + "community/wheelofdestiny/icon_spelldamage.png",
            Q = JS_DIR_IMAGES + "community/wheelofdestiny/icon_cooldown_reduction.png",
            R = JS_DIR_IMAGES + "community/wheelofdestiny/icon_crit.png",
            On);
            try {
                createModule().then(e=>{
                    ae(r),
                    Ce = e,
                    e = Ce,
                    u.set(P.Knight, e.EVocation.Knight),
                    u.set(P.Druid, e.EVocation.Druid),
                    u.set(P.Sorcerer, e.EVocation.Sorcerer),
                    u.set(P.Paladin, e.EVocation.Paladin),
                    V.set(e.EVocation.Knight, P.Knight),
                    V.set(e.EVocation.Druid, P.Druid),
                    V.set(e.EVocation.Sorcerer, P.Sorcerer),
                    V.set(e.EVocation.Paladin, P.Paladin),
                    u.set(P.t, e.EQuarter.TL),
                    u.set(P.l, e.EQuarter.TR),
                    u.set(P.i, e.EQuarter.BL),
                    u.set(P.o, e.EQuarter.BR),
                    V.set(e.EQuarter.TL, P.t),
                    V.set(e.EQuarter.TR, P.l),
                    V.set(e.EQuarter.BL, P.i),
                    V.set(e.EQuarter.BR, P.o),
                    u.set(P.QTL0, e.EGridTile.QTL0),
                    u.set(P.QTL1, e.EGridTile.QTL1),
                    u.set(P.QTL2, e.EGridTile.QTL2),
                    u.set(P.QTL3, e.EGridTile.QTL3),
                    u.set(P.QTL4, e.EGridTile.QTL4),
                    u.set(P.QTL5, e.EGridTile.QTL5),
                    u.set(P.QTL6, e.EGridTile.QTL6),
                    u.set(P.QTL7, e.EGridTile.QTL7),
                    u.set(P.QTL8, e.EGridTile.QTL8),
                    u.set(P.QTR0, e.EGridTile.QTR0),
                    u.set(P.QTR1, e.EGridTile.QTR1),
                    u.set(P.QTR2, e.EGridTile.QTR2),
                    u.set(P.QTR3, e.EGridTile.QTR3),
                    u.set(P.QTR4, e.EGridTile.QTR4),
                    u.set(P.QTR5, e.EGridTile.QTR5),
                    u.set(P.QTR6, e.EGridTile.QTR6),
                    u.set(P.QTR7, e.EGridTile.QTR7),
                    u.set(P.QTR8, e.EGridTile.QTR8),
                    u.set(P.QBL0, e.EGridTile.QBL0),
                    u.set(P.QBL1, e.EGridTile.QBL1),
                    u.set(P.QBL2, e.EGridTile.QBL2),
                    u.set(P.QBL3, e.EGridTile.QBL3),
                    u.set(P.QBL4, e.EGridTile.QBL4),
                    u.set(P.QBL5, e.EGridTile.QBL5),
                    u.set(P.QBL6, e.EGridTile.QBL6),
                    u.set(P.QBL7, e.EGridTile.QBL7),
                    u.set(P.QBL8, e.EGridTile.QBL8),
                    u.set(P.QBR0, e.EGridTile.QBR0),
                    u.set(P.QBR1, e.EGridTile.QBR1),
                    u.set(P.QBR2, e.EGridTile.QBR2),
                    u.set(P.QBR3, e.EGridTile.QBR3),
                    u.set(P.QBR4, e.EGridTile.QBR4),
                    u.set(P.QBR5, e.EGridTile.QBR5),
                    u.set(P.QBR6, e.EGridTile.QBR6),
                    u.set(P.QBR7, e.EGridTile.QBR7),
                    u.set(P.QBR8, e.EGridTile.QBR8),
                    V.set(e.EGridTile.QTL0, P.QTL0),
                    V.set(e.EGridTile.QTL1, P.QTL1),
                    V.set(e.EGridTile.QTL2, P.QTL2),
                    V.set(e.EGridTile.QTL3, P.QTL3),
                    V.set(e.EGridTile.QTL4, P.QTL4),
                    V.set(e.EGridTile.QTL5, P.QTL5),
                    V.set(e.EGridTile.QTL6, P.QTL6),
                    V.set(e.EGridTile.QTL7, P.QTL7),
                    V.set(e.EGridTile.QTL8, P.QTL8),
                    V.set(e.EGridTile.QTR0, P.QTR0),
                    V.set(e.EGridTile.QTR1, P.QTR1),
                    V.set(e.EGridTile.QTR2, P.QTR2),
                    V.set(e.EGridTile.QTR3, P.QTR3),
                    V.set(e.EGridTile.QTR4, P.QTR4),
                    V.set(e.EGridTile.QTR5, P.QTR5),
                    V.set(e.EGridTile.QTR6, P.QTR6),
                    V.set(e.EGridTile.QTR7, P.QTR7),
                    V.set(e.EGridTile.QTR8, P.QTR8),
                    V.set(e.EGridTile.QBL0, P.QBL0),
                    V.set(e.EGridTile.QBL1, P.QBL1),
                    V.set(e.EGridTile.QBL2, P.QBL2),
                    V.set(e.EGridTile.QBL3, P.QBL3),
                    V.set(e.EGridTile.QBL4, P.QBL4),
                    V.set(e.EGridTile.QBL5, P.QBL5),
                    V.set(e.EGridTile.QBL6, P.QBL6),
                    V.set(e.EGridTile.QBL7, P.QBL7),
                    V.set(e.EGridTile.QBL8, P.QBL8),
                    V.set(e.EGridTile.QBR0, P.QBR0),
                    V.set(e.EGridTile.QBR1, P.QBR1),
                    V.set(e.EGridTile.QBR2, P.QBR2),
                    V.set(e.EGridTile.QBR3, P.QBR3),
                    V.set(e.EGridTile.QBR4, P.QBR4),
                    V.set(e.EGridTile.QBR5, P.QBR5),
                    V.set(e.EGridTile.QBR6, P.QBR6),
                    V.set(e.EGridTile.QBR7, P.QBR7),
                    V.set(e.EGridTile.QBR8, P.QBR8),
                    u.set(P.u, e.EMediumPerkCategory.Unique),
                    u.set(P.g, e.EMediumPerkCategory.SkillBonus),
                    u.set(P.h, e.EMediumPerkCategory.Leech),
                    u.set(P.v, e.EMediumPerkCategory.Augmentation),
                    u.set(P.m, e.EMediumPerkCategory.VesselResonance),
                    u.set(P.p, e.EMediumPerkCategory.Other),
                    V.set(e.EMediumPerkCategory.Unique, P.u),
                    V.set(e.EMediumPerkCategory.SkillBonus, P.g),
                    V.set(e.EMediumPerkCategory.Leech, P.h),
                    V.set(e.EMediumPerkCategory.Augmentation, P.v),
                    V.set(e.EMediumPerkCategory.VesselResonance, P.m),
                    V.set(e.EMediumPerkCategory.Other, P.p),
                    u.set(P.A, e.ESupremeModCategory.ModEffect),
                    u.set(P.k, e.ESupremeModCategory.ModAugCd),
                    u.set(P.$, e.ESupremeModCategory.ModAugCrit),
                    u.set(P.I, e.ESupremeModCategory.ModAugDmg),
                    u.set(P.G, e.ESupremeModCategory.ModAugHeal),
                    u.set(P.M, e.ESupremeModCategory.ModAugOther),
                    u.set(P.R, e.ESupremeModCategory.ModRevelation),
                    V.set(e.ESupremeModCategory.ModEffect, P.A),
                    V.set(e.ESupremeModCategory.ModAugCd, P.k),
                    V.set(e.ESupremeModCategory.ModAugCrit, P.$),
                    V.set(e.ESupremeModCategory.ModAugDmg, P.I),
                    V.set(e.ESupremeModCategory.ModAugHeal, P.G),
                    V.set(e.ESupremeModCategory.ModAugOther, P.M),
                    V.set(e.ESupremeModCategory.ModRevelation, P.R),
                    s(!0, Jn)
                }
                )["catch"](e=>{
                    ie(n, "It appears that your browser version is too old to use the Wheel of Destiny Planner. Please use a different browser!"),
                    ae(n)
                }
                )
            } catch (nt) {
                ie(n, "Loading the Wheel of Destiny Planner failed. Please check if your browser or plugins are blocking the loading process!"),
                ae(n)
            }
            {
                e = JS_DIR_IMAGES + "community/wheelofdestiny";
                var Vn = JS_DIR_IMAGES + "global/common/skillwheel";
                var zn = Nn;
                const tt = new Image
                  , rt = (tt.src = e + "/backdrop_skillwheel.png",
                tt.onload = function() {
                    ke = tt,
                    re()
                }
                ,
                new Image)
                  , at = (rt.src = e + "/backdrop_skillwheel_largebonus_socketdisabled.png",
                rt.onload = function() {
                    we = rt,
                    re()
                }
                ,
                new Image)
                  , lt = (at.src = e + "/backdrop_skillwheel_largebonus_socketenabled.png",
                at.onload = function() {
                    $e = at,
                    re()
                }
                ,
                new Image)
                  , it = (lt.src = e + "/backdrop_skillwheel_largebonus_light.png",
                lt.onload = function() {
                    Ie = lt,
                    re()
                }
                ,
                new Image)
                  , ot = (it.src = e + "/backdrop_skillwheel_front.png",
                it.onload = function() {
                    be = it,
                    re()
                }
                ,
                new Image)
                  , ut = (ot.src = e + "/backdrop_skillwheel_largebonus_front0.png",
                ot.onload = function() {
                    Ge = ot,
                    re()
                }
                ,
                new Image)
                  , st = (ut.src = e + "/backdrop_skillwheel_largebonus_front1.png",
                ut.onload = function() {
                    Me = ut,
                    re()
                }
                ,
                new Image)
                  , dt = (st.src = e + "/backdrop_skillwheel_largebonus_front2.png",
                st.onload = function() {
                    Qe = st,
                    re()
                }
                ,
                new Image)
                  , ct = (dt.src = e + "/backdrop_skillwheel_largebonus_front3.png",
                dt.onload = function() {
                    Re = dt,
                    re()
                }
                ,
                new Image)
                  , ft = (ct.src = e + "/icons-skillwheel-largeperks.png" + zn,
                ct.onload = function() {
                    Te = ct,
                    re()
                }
                ,
                new Image)
                  , gt = (ft.src = e + "/marker_largeperk.png",
                ft.onload = function() {
                    _e = ft,
                    re()
                }
                ,
                new Image)
                  , ht = (gt.src = Vn + "/icons-gematelier-gemvariants.png",
                gt.onload = function() {
                    Le = gt,
                    re()
                }
                ,
                new Image)
                  , vt = (ht.src = e + "/icons-skillwheel-sockets.png",
                ht.onload = function() {
                    xe = ht,
                    re()
                }
                ,
                new Image)
                  , mt = (vt.src = Vn + "/icons-skillwheel-basicmods.png" + zn,
                vt.onload = function() {
                    Se = vt,
                    re()
                }
                ,
                new Image)
                  , pt = (mt.src = Vn + "/icons-skillwheel-suprememods.png" + zn,
                mt.onload = function() {
                    qe = mt,
                    re()
                }
                ,
                new Image)
                  , At = (pt.src = e + "/marker-skillwheelsocket.png",
                pt.onload = function() {
                    Be = pt,
                    re()
                }
                ,
                new Image)
                  , kt = (At.src = e + "/icons-skillwheel-mediumperks.png" + zn,
                At.onload = function() {
                    ye = At,
                    re()
                }
                ,
                new Image)
                  , wt = (kt.src = e + "/icons-skillwheel-smallperks.png" + zn,
                kt.onload = function() {
                    Pe = kt,
                    re()
                }
                ,
                new Image)
                  , $t = (wt.src = e + "/icon_skillwheel_vesselresonance_basic.png",
                wt.onload = function() {
                    De = wt,
                    re()
                }
                ,
                new Image);
                $t.src = e + "/icon_skillwheel_vesselresonance_supreme.png",
                $t.onload = function() {
                    We = $t,
                    re()
                }
            }
            gn(),
            CopyTextOfElement(f, ue),
            CopyTextOfElement(M, de),
            $("#" + w).click(function() {
                Yn($(this))
            }),
            $("#" + _).click(function() {
                Yn($(this))
            }),
            $("#" + I).click(function() {
                bn($("#" + G))
            }),
            $("#" + L).click(function() {
                bn($("#" + B))
            }),
            $("#" + b).click(function() {
                Wn("")
            }),
            $("#" + x).click(function() {
                Wn("")
            }),
            $("#" + B).keyup(function(e) {
                var n = $("#" + B);
                $("#" + G).val(n.val()),
                et(e, $(this))
            }),
            $("#" + G).keyup(function(e) {
                var n = $("#" + G);
                $("#" + B).val(n.val()),
                et(e, $(this))
            }),
            In(P.Knight),
            In(P.Druid),
            In(P.Sorcerer),
            In(P.Paladin);
            {
                const It = $("#" + l);
                It.on("input blur", function(e) {
                    var n = It.val().trim().replace(/[^0-9]/g, "").slice(0, 4);
                    if (It.val(n),
                    /^[0-9]+$/.test(n)) {
                        n = parseInt(n);
                        if (!isNaN(n) && Number.isInteger(n) && 0 < n)
                            return void (o = n)
                    }
                    o = null
                })
            }
            {
                const bt = $("#" + S)
                  , Gt = $("#" + E)
                  , Mt = $("#" + q)
                  , Qt = $("#" + F);
                let r = undefined
                  , a = !1
                  , l = null;
                function Zn(e, n, t) {
                    if (("mousedown" != e.type || 1 == e.which) && (kn(e),
                    l = X,
                    n(t),
                    !a & !t)) {
                        a = !0;
                        let e = 0;
                        r = setInterval(()=>{
                            l !== X ? Kn() : e < 15 ? e++ : n(t)
                        }
                        , 30)
                    }
                }
                function Kn() {
                    clearInterval(r),
                    a = !1,
                    l = null
                }
                function jn(e, n, t, r, a) {
                    switch (e.code) {
                    case "Space":
                    case "Enter":
                        r && (kn(e),
                        r(a));
                        break;
                    case "ArrowLeft":
                        kn(e),
                        n && n.focus();
                        break;
                    case "ArrowRight":
                        kn(e),
                        t && t.focus()
                    }
                }
                function Xn(e) {
                    return e = e.originalEvent || e,
                    DeactivateHelperDiv(),
                    e.touches && 1 < e.touches.length
                }
                Mt.on("keydown", function(e) {
                    jn(e, bt, Qt, Un, wn(e))
                }),
                Mt.on("mousedown touchstart", function(e) {
                    Xn(e) || Zn(e, Un, wn(e))
                }),
                Mt.on("mouseup mouseout touchend touchcancel", function() {
                    Kn()
                }),
                Qt.on("keydown", function(e) {
                    jn(e, Mt, Gt, Cn, wn(e))
                }),
                Qt.on("mousedown touchstart", function(e) {
                    Xn(e) || Zn(e, Cn, wn(e))
                }),
                Qt.on("mouseup mouseout touchend touchcancel", function() {
                    Kn()
                }),
                bt.on("keydown", function(e) {
                    jn(e, null, Mt)
                }),
                bt.click(function() {
                    var e;
                    Kn(),
                    (e = Z.find(e=>e.id === X)) && 0 != e.fillPercent && e.editable && s(!1, null, "clearSkill", u.get(X))
                }),
                Gt.on("keydown", function(e) {
                    jn(e, Qt, null)
                }),
                Gt.click(function() {
                    var e, n;
                    Kn(),
                    (e = Z.find(e=>e.id === X)) && 1 != e.fillPercent && e.unlocked && (n = u.get(X),
                    null != o ? O < o && (e = e.maxSkillPoints - e.currentSkillPoints,
                    e = Math.min(e, o - O),
                    s(!1, null, "addToSkill", n, e)) : s(!1, null, "fillSkill", n))
                }),
                $(window).scroll(function(e) {
                    Kn()
                })
            }
            {
                const Rt = N + "-gem-mod1-dropdown"
                  , Tt = N + "-gem-mod2-dropdown"
                  , _t = N + "-gem-mod3-dropdown"
                  , Lt = $(`select[name="${Rt}"]`)
                  , xt = $(`select[name="${Tt}"]`)
                  , Bt = $(`select[name="${_t}"]`);
                Lt.change(function(e) {
                    Fn(1, $(this).val()),
                    Lt.focus()
                }),
                xt.change(function(e) {
                    Fn(2, $(this).val()),
                    xt.focus()
                }),
                Bt.change(function(e) {
                    Fn(3, $(this).val()),
                    Bt.focus()
                })
            }
            $.getJSON(t).done(e=>{
                y = e,
                Bn(),
                y.SliceRightClickInfo && ie(fe + "-fillinfo", y.SliceRightClickInfo),
                y.SmallPerkInfos.DisplayName && ie(he + "-header", y.SmallPerkInfos.DisplayName + "s"),
                y.MediumPerkInfos.DisplayName && ie(ve + "-header", y.MediumPerkInfos.DisplayName + "s"),
                y.LargePerkInfos.DisplayName && ie(me + "-header", y.LargePerkInfos.DisplayName + "s"),
                y.VesselInfos.DisplayName && ie(pe + "-header", y.VesselInfos.DisplayName + "s"),
                y.CooldownLimitInfo && ie(Ae, y.CooldownLimitInfo)
            }
            )
        }
    }
    function Yn(e) {
        var n, t = window.location.href;
        t && ((n = document.createElement("input")).style = "position: absolute; left: -1000px; top: -1000px; opacity: 0;",
        n.value = t,
        document.body.appendChild(n),
        n.select(),
        document.execCommand("copy"),
        document.body.removeChild(n),
        e.focus())
    }
    function et(e, n) {
        "Enter" === e.code && n.val().trim() && bn(n)
    }
}
